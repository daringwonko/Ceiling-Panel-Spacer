---
phase: 06-bim-workbench
plan: 10
type: execute
wave: 3
depends_on: ["06-09"]
files_modified:
  - bim/objects/structural.py
  - bim/objects/wall.py
  - bim/objects/beam.py
  - bim/objects/column.py
  - bim/objects/slab.py
  - bim/gui/structural_tools.py
  - bim/property/structural_props.py
  - bim/preview/structural_preview.py
autonomous: true
must_haves:
  truths:
    - "User can create Wall by drawing line and setting height/thickness"
    - "User can create Beam by clicking start and end points"
    - "User can create Column by clicking position and setting height"
    - "User can create Slab by drawing boundary polygon"
    - "All structural objects have editable dimensions in properties panel"
    - "Real-time preview shows during object creation"
    - "Material can be assigned to all structural objects"
  artifacts:
    - path: "bim/objects/wall.py"
      provides: "Wall class with parametric properties"
      exports: ["Wall", "create_wall"]
    - path: "bim/objects/beam.py"
      provides: "Beam class with parametric properties"
      exports: ["Beam", "create_beam"]
    - path: "bim/objects/column.py"
      provides: "Column class with parametric properties"
      exports: ["Column", "create_column"]
    - path: "bim/objects/slab.py"
      provides: "Slab class with parametric properties"
      exports: ["Slab", "create_slab"]
    - path: "bim/gui/structural_tools.py"
      provides: "GUI tools for structural object creation"
      exports: ["WallTool", "BeamTool", "ColumnTool", "SlabTool"]
    - path: "bim/property/structural_props.py"
      provides: "Property panels for structural objects"
      exports: ["WallPropertyPanel", "BeamPropertyPanel", "ColumnPropertyPanel", "SlabPropertyPanel"]
  key_links:
    - from: "bim/gui/structural_tools.py"
      to: "bim/objects/*.py"
      via: "import and create object"
      pattern: "create_wall|create_beam|create_column|create_slab"
    - from: "bim/objects/*.py"
      to: "bim/property/structural_props.py"
      via: "property registration"
      pattern: "property_panel.register"
    - from: "bim/preview/structural_preview.py"
      to: "bim/gui/structural_tools.py"
      via: "preview updates during drawing"
      pattern: "preview.*draw|update_preview"
---

<objective>
Implement structural BIM objects: Wall, Beam, Column, and Slab. These are fundamental 3D building elements with parametric editing capabilities.

Purpose: Provide users with core structural modeling tools for BIM workflows, enabling creation of building frame elements with precise dimensional control and material assignment.

Output: Four structural object types (Wall, Beam, Column, Slab) with parametric properties, GUI creation tools, and real-time preview.
</objective>

<execution_context>
@/home/tomas/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/tomas/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@bim/BIM_Workbench.md

# Prior structural foundation
@.planning/phases/06-bim-workbench/06-09-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Wall Tool and Object</name>
  <files>bim/objects/wall.py, bim/gui/structural_tools.py</files>
  <action>
    Implement Wall structural object with the following capabilities:

    1. Wall Class (bim/objects/wall.py):
       - Properties: length, height, thickness, start_point, end_point, material, level
       - Base point: calculated from line on working plane
       - Extrude vertical from working plane to height
       - Store base line coordinates for parametric editing
       - Validate thickness > 0, height > 0

    2. Wall Creation Tool:
       - Click to set start point on working plane
       - Click to set end point on working plane
       - Draw line showing wall base while dragging
       - Preview: show translucent extruded wall during drawing
       - After second click: create solid wall with default height/thickness
       - Tool state: idle -> drawing_base -> complete

    3. Preview System:
       - While drawing: show base line + translucent extruded preview
       - Preview color: light blue (neutral)
       - Update in real-time as mouse moves

    4. Working Plane Integration:
       - Project clicks onto active working plane
       - Use working plane normal for extrusion direction
       - Support creating walls on any oriented plane
  </action>
  <verify>
    Run structural test: python -c "from bim.objects.wall import Wall; w = Wall(start=(0,0,0), end=(3000,0,0), height=2800, thickness=200); print(w.length, w.volume)"
  </verify>
  <done>
    Wall class created with parametric properties. Wall tool draws base line on working plane and creates extruded solid. Preview shows during drawing.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Beam Tool and Object</name>
  <files>bim/objects/beam.py, bim/gui/structural_tools.py</files>
  <action>
    Implement Beam structural object:

    1. Beam Class (bim/objects/beam.py):
       - Properties: start_point, end_point, profile_width, profile_height, material, elevation
       - Profile: rectangular by default (width x height cross-section)
       - Calculate length from start/end points
       - Extrude profile along vector from start to end
       - Validate width > 0, height > 0

    2. Beam Creation Tool:
       - Click to set beam start point
       - Click to set beam end point
       - Preview: show line with rectangular profile outline during drawing
       - Create beam with default profile (200x400mm typical)
       - Position at specified elevation above working plane

    3. Beam Orientation:
       - Align beam along vector between start/end points
       - Profile perpendicular to beam axis
       - Default: profile height in Z direction when horizontal
       - Option: rotate profile 90 degrees for vertical orientation

    4. Elevation Control:
       - Default elevation: 0 (on working plane)
       - Support elevation offset for placing at different levels
       - Show current elevation in tool status
  </action>
  <verify>
    Run beam test: python -c "from bim.objects.beam import Beam; b = Beam(start=(0,0,2800), end=(5000,0,2800), profile_width=200, profile_height=400); print(b.length, b.volume)"
  </verify>
  <done>
    Beam class created with rectangular profile. Beam tool creates horizontal structural element between two clicked points. Preview shows profile outline.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Column Tool and Object</name>
  <files>bim/objects/column.py, bim/gui/structural_tools.py</files>
  <action>
    Implement Column structural object:

    1. Column Class (bim/objects/column.py):
       - Properties: position (x,y), base_elevation, height, profile_type, profile_size, material
       - Profile types: rectangle, circle
       - Rectangle: width x depth
       - Circle: diameter
       - Extrude vertically from base_elevation to base_elevation + height
       - Validate height > 0, profile dimensions > 0

    2. Column Creation Tool:
       - Single click to set column position on working plane
       - Create column at clicked position with default height
       - Preview: show wireframe outline of column base + height while hovering
       - Profile shape: rectangle or circle outline depending on type

    3. Profile Options:
       - Default: rectangular column (300x300mm typical)
       - Support circular columns (diameter 300mm typical)
       - Allow switching profile type during creation (tool option)

    4. Level Integration:
       - Base elevation relative to current level
       - Height extends from base to top
       - Auto-calculate if multi-story (option)
  </action>
  <verify>
    Run column test: python -c "from bim.objects.column import Column; c = Column(position=(2500,2500), height=3000, profile_type='rectangle', width=300, depth=300); print(c.top_elevation, c.volume)"
  </verify>
  <done>
    Column class created with rectangle/circle profiles. Column tool places vertical element with single click. Preview shows column outline.
  </done>
</task>

<task type="auto">
  <name>Task 4: Create Slab Tool and Object</name>
  <files>bim/objects/slab.py, bim/gui/structural_tools.py</files>
  <action>
    Implement Slab structural object:

    1. Slab Class (bim/objects/slab.py):
       - Properties: boundary_points [], thickness, elevation, material, extrude_direction
       - Boundary: list of (x,y) points forming closed polygon
       - Extrude: thickness in specified direction (up/down)
       - Validate closed polygon, thickness > 0
       - Calculate area from boundary polygon

    2. Slab Creation Tool:
       - Click multiple points to draw slab boundary (polyline mode)
       - Support rectangle mode: 2 clicks for opposite corners
       - Close boundary automatically or require explicit close (Enter/click first point)
       - Preview: show translucent slab face during drawing

    3. Slab Options:
       - Default thickness: 200mm
       - Extrude direction: downward (typical) or upward
       - Elevation: top of slab position
       - Show current area in tool status

    4. Validation:
       - Require minimum 3 points for valid polygon
       - Check polygon is closed (last point connects to first)
       - Prevent self-intersecting polygons (warn user)
  </action>
  <verify>
    Run slab test: python -c "from bim.objects.slab import Slab; s = Slab(boundary=[(0,0), (5000,0), (5000,5000), (0,5000)], thickness=200, elevation=3000); print(s.area, s.volume)"
  </verify>
  <done>
    Slab class created with polygonal boundary. Slab tool draws closed shape and extrudes to thickness. Supports rectangle or polyline drawing modes.
  </done>
</task>

<task type="auto">
  <name>Task 5: Add Parametric Editing and Property Panels</name>
  <files>bim/property/structural_props.py, bim/objects/wall.py, bim/objects/beam.py, bim/objects/column.py, bim/objects/slab.py</files>
  <action>
    Implement parametric editing for all structural objects:

    1. Property Panel Framework (bim/property/structural_props.py):
       - Create base class for structural property panels
       - Register panels for each object type
       - Bind to selected object

    2. Wall Properties Panel:
       - Edit: length, height, thickness (numeric inputs)
       - Edit: start_point, end_point (coordinate inputs)
       - Edit: material (dropdown from material library)
       - Edit: level (dropdown from level manager)
       - Real-time update on value change

    3. Beam Properties Panel:
       - Edit: start_point, end_point (coordinates)
       - Edit: profile_width, profile_height
       - Edit: elevation
       - Edit: material

    4. Column Properties Panel:
       - Edit: position (x,y coordinates)
       - Edit: height, base_elevation
       - Edit: profile_type (dropdown: rectangle/circle)
       - Edit: profile dimensions (width/depth or diameter)
       - Edit: material

    5. Slab Properties Panel:
       - Edit: thickness
       - Edit: elevation (top of slab)
       - Edit: extrude_direction (up/down toggle)
       - Show: area (read-only)
       - Edit: material

    6. Real-Time Updates:
       - On any property change: regenerate geometry
       - Maintain object identity (update, don't recreate)
       - Validate new values before applying
       - Revert to previous value if invalid
  </action>
  <verify>
    Run property test: python -c "from bim.property.structural_props import WallPropertyPanel; print('Property panels loaded')" && verify that editing wall height in UI updates the 3D model
  </verify>
  <done>
    Property panels created for all 4 structural object types. Editing dimensions, materials, or positions updates the 3D model in real-time.
  </done>
</task>

</tasks>

<verification>
1. **Structural Object Creation:**
   - Wall: Draw line on working plane → extruded wall appears
   - Beam: Click start/end points → beam appears
   - Column: Click position → column appears
   - Slab: Draw closed shape → slab appears

2. **Parametric Properties:**
   - Select each object type → properties panel shows editable fields
   - Change height/thickness → geometry updates immediately
   - Change material → appearance updates

3. **Preview System:**
   - During wall drawing: translucent wall preview follows mouse
   - During beam drawing: profile outline preview
   - During slab drawing: face outline preview

4. **Validation:**
   - Invalid dimensions (<= 0) rejected with error
   - Open slab boundary warns user
   - All objects respond to working plane orientation
</verification>

<success_criteria>
- [ ] Wall object: Created from base line, extruded to height, editable length/height/thickness
- [ ] Beam object: Created between two points, rectangular profile, editable dimensions
- [ ] Column object: Created at position, rectangle or circle profile, editable height
- [ ] Slab object: Created from closed boundary, extruded thickness, editable thickness
- [ ] All objects: Material property, elevation/level property
- [ ] GUI tools: Wall tool (2-click), Beam tool (2-click), Column tool (1-click), Slab tool (polyline)
- [ ] Real-time preview: Shows during object creation for all tools
- [ ] Property panels: Separate panel for each object type with all editable properties
- [ ] Working plane: All tools respect active working plane orientation
</success_criteria>

<output>
After completion, create `.planning/phases/06-bim-workbench/06-10-SUMMARY.md` documenting:
- Wall, Beam, Column, Slab implementations
- Property panel structure
- Preview system
- Sample usage of each structural object
</output>
