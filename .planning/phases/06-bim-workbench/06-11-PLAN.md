---
phase: 06-bim-workbench
plan: 11
type: execute
wave: 3
depends_on: ["06-10"]
files_modified:
  - src/freecad/bim_workbench/tools/door_tool.py
  - src/freecad/bim_workbench/tools/window_tool.py
  - src/freecad/bim_workbench/tools/stairs_tool.py
  - src/freecad/bim_workbench/tools/roof_tool.py
  - src/freecad/bim_workbench/objects/door.py
  - src/freecad/bim_workbench/objects/window.py
  - src/freecad/bim_workbench/objects/stairs.py
  - src/freecad/bim_workbench/objects/roof.py
  - src/freecad/bim_workbench/presets/door_presets.py
  - src/freecad/bim_workbench/presets/window_presets.py
  - src/freecad/bim_workbench/presets/__init__.py
  - tests/test_building_elements.py
autonomous: true
must_haves:
  truths:
    - User can place doors on walls with width, height, and swing settings
    - User can place windows on walls with width, height, and sill settings
    - Doors and windows cut openings through wall geometry
    - User can create stairs with calculated riser and tread dimensions
    - User can generate roofs from closed wire profiles with slope and overhang
    - Door swing displays 2D arc representation
    - Stairs show 3D preview during creation
  artifacts:
    - path: src/freecad/bim_workbench/objects/door.py
      provides: Door object class with wall-cutting capability
      exports: ["Door", "makeDoor"]
    - path: src/freecad/bim_workbench/objects/window.py
      provides: Window object class with wall-cutting capability
      exports: ["Window", "makeWindow"]
    - path: src/freecad/bim_workbench/objects/stairs.py
      provides: Stairs object with path and riser/tread calculations
      exports: ["Stairs", "makeStairs"]
    - path: src/freecad/bim_workbench/objects/roof.py
      provides: Roof object with slope and overhang generation
      exports: ["Roof", "makeRoof"]
    - path: src/freecad/bim_workbench/presets/door_presets.py
      provides: Door preset configurations
    - path: src/freecad/bim_workbench/presets/window_presets.py
      provides: Window preset configurations
    - path: tests/test_building_elements.py
      provides: Unit tests for building element creation
  key_links:
    - from: door_tool.py
      to: objects/door.py
      via: Door class instantiation
      pattern: "Door.create"
    - from: window_tool.py
      to: objects/window.py
      via: Window class instantiation
      pattern: "Window.create"
    - from: Door/Window objects
      to: Host wall
      via: FreeCAD boolean cut
      pattern: "cut.*Base"
    - from: stairs_tool.py
      to: objects/stairs.py
      via: Stairs class instantiation with path
      pattern: "Stairs.*path"
    - from: roof_tool.py
      to: objects/roof.py
      via: Roof class instantiation from wire
      pattern: "Roof.*wire"
---

<objective>
Implement four core building element types for the BIM Workbench: Door, Window, Stairs, and Roof. Each element must integrate with walls and other architectural components, support interactive placement, and provide configurable parameters through the FreeCAD task panel.

Purpose: Enable users to add essential architectural elements to their building models with proper wall integration and parametric controls.

Output: Four complete building element types with tool implementations, object classes, preset configurations, and comprehensive test coverage.
</objective>

<execution_context>
@/home/tomas/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/tomas/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-bim-workbench/BIM_Workbench.md
@src/freecad/bim_workbench/objects/wall.py
@src/freecad/bim_workbench/base/object_base.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Door Tool and Object</name>
  <files>
    src/freecad/bim_workbench/tools/door_tool.py
    src/freecad/bim_workbench/objects/door.py
  </files>
  <action>
    Create Door object class in objects/door.py:
    - Inherit from BIMObject base class
    - Properties: Width (800-2000mm), Height (1800-2400mm), SillHeight (0-300mm)
    - Property: SwingDirection (Left, Right, Double, Sliding)
    - Method: cutWall() to perform boolean cut on host wall
    - Method: createSwingArc() for 2D swing arc visualization
    - Export makeDoor(hostWall, position, width, height) function
    
    Create DoorTool in tools/door_tool.py:
    - Inherit from BimTool base class
    - Activated: Allow wall face selection
    - On click: Place door at click point on selected wall
    - Task panel: Width, Height, SillHeight, SwingDirection inputs
    - Apply: Create Door object and cut opening in wall
    - Show swing arc in 2D view
  </action>
  <verify>
    cd tests && python -c "from src.freecad.bim_workbench.objects.door import Door, makeDoor; print('Door module imports OK')"
    python -m pytest tests/test_building_elements.py::test_door_creation -v
  </verify>
  <done>
    Door object class created with all properties
    DoorTool allows wall click-to-place interaction
    Doors cut openings through wall geometry
    2D swing arc displays correctly
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Window Tool and Object</name>
  <files>
    src/freecad/bim_workbench/tools/window_tool.py
    src/freecad/bim_workbench/objects/window.py
  </files>
  <action>
    Create Window object class in objects/window.py:
    - Inherit from BIMObject base class
    - Properties: Width (300-2000mm), Height (300-2400mm), SillHeight (0-2000mm)
    - Property: WindowType (Fixed, SingleHung, DoubleHung, Casement, Sliding)
    - Property: FrameWidth (10-100mm)
    - Property: GlassThickness (3-20mm)
    - Method: cutWall() to perform boolean cut on host wall
    - Export makeWindow(hostWall, position, width, height) function
    
    Create WindowTool in tools/window_tool.py:
    - Inherit from BimTool base class
    - Activated: Allow wall face selection
    - On click: Place window at click point on selected wall
    - Task panel: Width, Height, SillHeight, WindowType inputs
    - Apply: Create Window object and cut opening in wall
    - Generate frame and glass geometry based on type
  </action>
  <verify>
    cd tests && python -c "from src.freecad.bim_workbench.objects.window import Window, makeWindow; print('Window module imports OK')"
    python -m pytest tests/test_building_elements.py::test_window_creation -v
  </verify>
  <done>
    Window object class created with all properties
    WindowTool allows wall click-to-place interaction
    Windows cut openings through wall geometry
    Frame and glass geometry generated per window type
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Stairs Tool and Object</name>
  <files>
    src/freecad/bim_workbench/tools/stairs_tool.py
    src/freecad/bim_workbench/objects/stairs.py
  </files>
  <action>
    Create Stairs object class in objects/stairs.py:
    - Inherit from BIMObject base class
    - Properties: TotalRise (500-5000mm), TotalRun (500-10000mm)
    - Property: TreadDepth (200-400mm)
    - Property: RiserHeight (150-200mm) - auto-calculated from rise/count
    - Property: StairCount (2-50) - auto-calculated from rise/riser
    - Property: StairWidth (600-1500mm)
    - Property: PathType (Straight, LShape, UShape)
    - Method: calculateRisers() - compute optimal riser height
    - Method: generateGeometry() - create 3D stair geometry
    - Export makeStairs(path, totalRise, treadDepth) function
    
    Create StairsTool in tools/stairs_tool.py:
    - Inherit from BimTool base class
    - Activated: Allow drawing stair path (line segments)
    - Support 2-point (straight), 3-point (L-shape), 4-point (U-shape) paths
    - Task panel: TotalRise, TreadDepth, StairWidth inputs
    - Real-time preview: Update 3D geometry as parameters change
    - Apply: Finalize stairs object with calculated dimensions
  </action>
  <verify>
    cd tests && python -c "from src.freecad.bim_workbench.objects.stairs import Stairs, makeStairs; print('Stairs module imports OK')"
    python -m pytest tests/test_building_elements.py::test_stairs_creation -v
  </verify>
  <done>
    Stairs object class created with rise/run calculations
    StairsTool supports path drawing (straight, L, U shapes)
    Auto-calculation of riser height and stair count
    3D preview updates in real-time during creation
  </done>
</task>

<task type="auto">
  <name>Task 4: Create Roof Tool and Object</name>
  <files>
    src/freecad/bim_workbench/tools/roof_tool.py
    src/freecad/bim_workbench/objects/roof.py
  </files>
  <action>
    Create Roof object class in objects/roof.py:
    - Inherit from BIMObject base class
    - Properties: SlopeAngle (5-60 degrees)
    - Property: Overhang (0-1000mm)
    - Property: RoofType (Gable, Hip, Shed, Flat)
    - Property: Thickness (10-500mm)
    - Property: BaseWire (reference to selected wire)
    - Method: generateFromWire() - create roof from closed wire profile
    - Method: applyRoofType() - generate geometry per roof type
    - Export makeRoof(baseWire, slopeAngle, roofType) function
    
    Create RoofTool in tools/roof_tool.py:
    - Inherit from BimTool base class
    - Activated: Allow closed wire/polyline selection
    - Validate: Selection must be closed planar wire
    - Task panel: SlopeAngle, Overhang, RoofType, Thickness inputs
    - Preview: Show wireframe preview before apply
    - Apply: Generate 3D roof geometry with specified parameters
    
    Roof type implementations:
    - Gable: Triangular roof sections on opposite sides
    - Hip: Sloped on all sides meeting at ridge
    - Shed: Single slope
    - Flat: Minimal slope for drainage
  </action>
  <verify>
    cd tests && python -c "from src.freecad.bim_workbench.objects.roof import Roof, makeRoof; print('Roof module imports OK')"
    python -m pytest tests/test_building_elements.py::test_roof_creation -v
  </verify>
  <done>
    Roof object class created with slope and overhang properties
    RoofTool validates closed wire selection
    All roof types (gable, hip, shed, flat) generate correctly
    3D roof geometry generated from base wire profile
  </done>
</task>

<task type="auto">
  <name>Task 5: Create Door and Window Presets</name>
  <files>
    src/freecad/bim_workbench/presets/__init__.py
    src/freecad/bim_workbench/presets/door_presets.py
    src/freecad/bim_workbench/presets/window_presets.py
    tests/test_building_elements.py
  </files>
  <action>
    Create presets package structure:
    - Create __init__.py with preset registration
    - Define Preset class: name, dimensions, type, icon
    
    Door Presets (door_presets.py):
    - Single_Standard: 900mm x 2100mm, swing right
    - Single_Narrow: 800mm x 2100mm, swing right
    - Double_French: 1200mm x 2100mm, double swing
    - Sliding_Patio: 1800mm x 2100mm, sliding
    - Entry_Large: 1000mm x 2400mm, swing left
    
    Window Presets (window_presets.py):
    - Small_Fixed: 600mm x 600mm, sill 900mm, fixed
    - Standard_Casement: 900mm x 1200mm, sill 900mm, casement
    - DoubleHung_Large: 1200mm x 1500mm, sill 800mm, double hung
    - Sliding_Horizontal: 1500mm x 1200mm, sill 900mm, sliding
    - Tall_Narrow: 600mm x 1800mm, sill 0mm (floor-to-ceiling), fixed
    - Bathroom_Awning: 600mm x 900mm, sill 1500mm, awning
    
    Update tools to show preset dropdown:
    - DoorTool: Add preset selection combo box
    - WindowTool: Add preset selection combo box
    - On preset select: Populate width/height/type fields
    
    Create comprehensive tests in test_building_elements.py:
    - Test door creation with each preset
    - Test window creation with each preset
    - Test wall cutting integration
    - Test stairs calculations
    - Test roof geometry generation
    - Test preset application
  </action>
  <verify>
    cd tests && python -c "from src.freecad.bim_workbench.presets import door_presets, window_presets; print('Presets import OK')"
    python -m pytest tests/test_building_elements.py -v --tb=short
  </verify>
  <done>
    Door presets: 5 configurations available
    Window presets: 6 configurations available
    Tools display preset dropdown and auto-populate fields
    All building elements have comprehensive test coverage
    Tests pass for object creation and wall integration
  </done>
</task>

</tasks>

<verification>
[ ] All 4 building element objects (Door, Window, Stairs, Roof) can be instantiated
[ ] Door and Window tools successfully cut openings in wall geometry
[ ] Door swing arc displays correctly in 2D view
[ ] Stairs auto-calculate riser height and stair count from total rise
[ ] Stairs 3D preview updates in real-time during parameter changes
[ ] Roof generates valid geometry for all types (gable, hip, shed, flat)
[ ] Roof validates closed wire selection and rejects open profiles
[ ] Door presets populate tool fields correctly (5 presets)
[ ] Window presets populate tool fields correctly (6 presets)
[ ] All tests in test_building_elements.py pass
[ ] No import errors or circular dependencies
[ ] Tools integrate with workbench toolbar and menu
</verification>

<success_criteria>
**Functional Success:**
- User can place doors on walls with configurable width, height, and swing
- User can place windows on walls with configurable dimensions and type
- Doors and windows create actual openings in wall geometry
- User can create stairs by drawing paths and setting rise/tread parameters
- Stairs display real-time 3D preview during creation
- User can generate roofs from closed wire profiles with slope and overhang
- All roof types (gable, hip, shed, flat) produce valid 3D geometry
- Preset configurations available for doors (5) and windows (6)

**Code Quality Success:**
- All object classes inherit from BIMObject base class
- Proper property definitions with valid ranges
- Tools follow BimTool pattern with task panels
- Boolean cuts on walls use FreeCAD Part API correctly
- Stairs calculations follow building codes (7-11 inch rise, 10-14 inch tread)
- Roof geometry handles edge cases (small wires, sharp angles)
- Comprehensive test coverage with >80% pass rate

**Integration Success:**
- Tools register with workbench and appear in toolbar
- Objects serialize/deserialize correctly
- Property changes update geometry in real-time
- No memory leaks or dangling references
</success_criteria>

<output>
After completion, create `.planning/phases/06-bim-workbench/06-11-SUMMARY.md`
</output>
