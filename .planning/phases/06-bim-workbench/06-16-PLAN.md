---
phase: 06-bim-workbench
plan: 16
type: execute
wave: 4
depends_on: ["06-15"]
files_modified: []
autonomous: true
must_haves:
  truths:
    - "User can generate orthographic plan views from 3D model"
    - "User can create section views with cut geometry"
    - "User can generate elevation views from any side"
    - "Views support hidden line removal and hatching"
    - "Views can be exported to SVG and DXF formats"
  artifacts:
    - path: "bim_workbench/views/projection.py"
      provides: "Orthographic projection engine"
      min_lines: 200
    - path: "bim_workbench/views/plan_view.py"
      provides: "Plan view generator"
      exports: ["PlanViewGenerator"]
    - path: "bim_workbench/views/section_view.py"
      provides: "Section view generator"
      exports: ["SectionViewGenerator"]
    - path: "bim_workbench/views/elevation_view.py"
      provides: "Elevation view generator"
      exports: ["ElevationViewGenerator"]
    - path: "bim_workbench/views/view_component.py"
      provides: "Interactive view display"
      exports: ["ViewComponent"]
    - path: "bim_workbench/views/templates/"
      provides: "Title block and paper size templates"
  key_links:
    - from: "Section plane component"
      to: "Section view generator"
      via: "plane definition"
      pattern: "section_plane.*get_definition"
    - from: "3D element geometry"
      to: "Projection engine"
      via: "shape.mesh"
      pattern: "element.*geometry.*projection"
    - from: "View generator"
      to: "SVG/DXF export"
      via: "view.to_svg() / view.to_dxf()"
      pattern: "export.*format"
---

<objective>
Generate 2D views (plans, sections, elevations) from 3D model and section planes.

Purpose: Enable architectural documentation workflow by creating professional 2D drawings from 3D BIM models. These views are essential for construction documents, permits, and fabrication.
Output: Complete view generation system with plan, section, and elevation capabilities, supporting export to industry-standard formats.
</objective>

<execution_context>
@/home/tomas/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/tomas/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/BIM_Workbench.md

# Prior plans for context
@.planning/phases/06-bim-workbench/06-15-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create view projection system</name>
  <files>bim_workbench/views/projection.py</files>
  <action>
    Create the core orthographic projection engine in `bim_workbench/views/projection.py`.
    
    Implement the following:
    1. OrthographicProjection class with project() method
    2. Transform 3D vertices to 2D using view direction matrix
    3. Handle face visibility based on normal direction
    4. Optional hidden line removal using Z-buffer or BSP tree
    5. Edge detection and wireframe generation
    
    The projection should:
    - Accept view direction (normal vector)
    - Accept up vector for orientation
    - Return projected 2D coordinates
    - Handle occlusion for hidden line removal
    
    Use NumPy for matrix operations. Support parallel projection only (no perspective).
  </action>
  <verify>
    Run projection tests: python -m pytest tests/test_projection.py -v
    Verify 3D cube projects to correct 2D square for each view direction
  </verify>
  <done>
    Projection system can transform 3D geometry to 2D with correct occlusion handling
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Plan View generator</name>
  <files>bim_workbench/views/plan_view.py</files>
  <action>
    Create plan view generator in `bim_workbench/views/plan_view.py`.
    
    Implement PlanViewGenerator class:
    1. Generate top-down projection at specified cut level
    2. Cut geometry at floor level showing wall thickness
    3. Show doors/windows as openings
    4. Apply hatching patterns to cut surfaces
    5. Support multiple floors/levels
    
    Methods:
    - generate(model, cut_level): Generate plan view
    - get_cut_geometry(elements, plane): Get geometry at cut plane
    - apply_hatching(surface, pattern): Apply standard architectural hatching
    - add_openings(walls, doors): Cut door/window openings in walls
    
    Standard hatch patterns: concrete, steel, wood, insulation
  </action>
  <verify>
    Test plan generation: python tests/test_plan_view.py
    Verify walls appear with correct thickness, doors show as openings
  </verify>
  <done>
    Plan views generate correctly with cut geometry and hatching
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Section View generator</name>
  <files>bim_workbench/views/section_view.py</files>
  <action>
    Create section view generator in `bim_workbench/views/section_view.py`.
    
    Implement SectionViewGenerator class:
    1. Project from section plane (from 06-15)
    2. Cut geometry at section plane
    3. Show elements intersecting the plane
    4. Apply hatching to cut surfaces
    5. Carry over annotations from 3D view
    
    Methods:
    - generate(model, section_plane): Generate section from plane
    - cut_geometry(elements, plane): Cut and project intersecting elements
    - get_cut_surfaces(geometry, plane): Extract surfaces at cut
    - project_to_section_view(geometry, plane): Project onto section plane
    - transfer_annotations(annotations, plane): Transform 3D annotations to 2D
    
    Section plane from Plan 06-15 provides origin and normal.
  </action>
  <verify>
    Test section generation: python tests/test_section_view.py
    Verify section cuts through walls, shows proper hatching
  </verify>
  <done>
    Section views generate from section planes with cut surfaces hatched
  </done>
</task>

<task type="auto">
  <name>Task 4: Create Elevation View generator</name>
  <files>bim_workbench/views/elevation_view.py</files>
  <action>
    Create elevation view generator in `bim_workbench/views/elevation_view.py`.
    
    Implement ElevationViewGenerator class:
    1. Side projection without cutting
    2. Show external faces visible from view direction
    3. Hide internal geometry
    4. Support cardinal directions (North, South, East, West)
    
    Methods:
    - generate(model, direction): Generate elevation from direction
    - get_visible_faces(elements, direction): Filter visible external faces
    - project_elevation(geometry, direction): Project to 2D elevation plane
    - add_direction_indicator(view, direction): Add north arrow or view label
    
    Directions:
    - NORTH: View from +Y direction
    - SOUTH: View from -Y direction  
    - EAST: View from +X direction
    - WEST: View from -X direction
    
    No cutting - just projection of visible exterior elements.
  </action>
  <verify>
    Test elevation generation: python tests/test_elevation_view.py
    Verify correct face visibility for each cardinal direction
  </verify>
  <done>
    Elevation views show external faces with proper visibility
  </done>
</task>

<task type="auto">
  <name>Task 5: Create View display component</name>
  <files>bim_workbench/views/view_component.py</files>
  <action>
    Create interactive view component in `bim_workbench/views/view_component.py`.
    
    Implement ViewComponent class:
    1. Display generated 2D view in UI
    2. Scale control (fit to window, custom scale)
    3. Pan and zoom interactions
    4. Export buttons for SVG/DXF
    5. Print support
    
    Features:
    - Canvas-based 2D rendering (SVG or Canvas API)
    - Mouse drag for pan
    - Scroll wheel for zoom
    - Scale dropdown (1:50, 1:100, 1:200, etc.)
    - Export to SVG, DXF, PNG buttons
    
    Integrate with workbench UI framework.
  </action>
  <verify>
    Test view component: python tests/test_view_component.py
    Verify pan, zoom, and export functions work correctly
  </verify>
  <done>
    Interactive view component displays 2D views with full navigation
  </done>
</task>

<task type="auto">
  <name>Task 6: Add view templates</name>
  <files>bim_workbench/views/templates/title_block.svg, bim_workbench/views/templates/paper_sizes.py</files>
  <action>
    Create view templates in `bim_workbench/views/templates/`.
    
    1. Title block SVG template:
       - Project name, drawing number, revision
       - Scale indicator
       - Date and author
       - Company logo placeholder
    
    2. Paper size definitions:
       - A0, A1, A2, A3, A4 (ISO)
       - ARCH D, ARCH E (US)
       - Letter, Legal, Tabloid
    
    3. North arrow SVG for plans
    
    4. View composition:
       - Combine view content with title block
       - Position view on paper
       - Add scale text
       - Add drawing metadata
    
    Templates should be editable/customizable by users.
  </action>
  <verify>
    Test template generation: python tests/test_templates.py
    Verify title blocks render correctly at each paper size
  </verify>
  <done>
    Title blocks, paper sizes, and north arrow templates ready
  </done>
</task>

</tasks>

<verification>
1. Orthographic projection correctly transforms 3D to 2D
2. Plan views show cut walls with proper hatching
3. Section views generate from section planes
4. Elevation views show correct external faces
5. View component supports pan, zoom, and export
6. Title blocks and paper sizes render correctly
7. Export to SVG produces valid SVG files
8. Export to DXF produces valid DXF files
9. Integration tests pass for full view generation workflow
</verification>

<success_criteria>
- Orthographic projection engine transforms 3D geometry to 2D coordinates
- Plan views generate with cut geometry and architectural hatching
- Section views created from section planes with cut surfaces hatched
- Elevation views show external faces visible from specified direction
- View component provides interactive display with pan, zoom, and export
- Title blocks, scale indicators, and north arrows included
- Standard paper sizes (A-series, ARCH series) supported
- Views exportable to SVG and DXF formats
- All view types pass integration tests with sample models
</success_criteria>

<output>
After completion, create `.planning/phases/06-bim-workbench/06-16-SUMMARY.md`
</output>
